---
title: "Chapter 2: Causality"
subtitle: "Data Transformation with Tidyverse Functions"
author: "Sho Miyazaki"
institute: "Keio University"
date: "5/26/2022"
output: 
  beamer_presentation:
    slide_level: 2
    toc: true
    theme: "Madrid"
    colortheme: "beaver"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(width = 100)
library(knitr)
library(cowplot)
```

# Overview

## Data Transformation

```{r fig.show="hold", out.width="80%", fig.align='center', echo=FALSE}
ggdraw() + 
  draw_image("figure/data-science-explore.png") 
```
*Source: [R for Data Science](https://r4ds.had.co.nz/explore-intro.html)*

---
```{r fig.show="hold", out.width="40%", fig.align='center',echo=FALSE}
ggdraw() + 
  draw_image("figure/tidyr_logo.png") 
ggdraw() + 
  draw_image("figure/dplyr_logo.png") 
```

## Load packages and data
\small
```{r warning=FALSE, message=FALSE}
## load packages
library(tidyverse)
library(qss)

## load data
resume <- read_csv("data/resume.csv")

# check data 
resume
```

## `dplyr` from `Tidyverse`

```{r fig.show="hold", out.width="80%", fig.align='center', echo=FALSE}
ggdraw() + 
  draw_image("figure/dplyr.png") 
```
*Source: [RStudio](https://www.rstudio.com/resources/webinars/tidyverse-visualization-manipulation-basics/)*

# Subset Data
## Extract Columns (`select`) and Rows (`filter`)

- `select`: Return columns by name/number/etc.
- `filter`: Return rows by name/number/etc.

\tiny
```{r}
## subset data with first name
resume_sex <- resume %>% 
  select(sex)
head(resume_sex, 3)
## subset data with black names
resumeB <- resume %>% 
  filter(race == "black")
head(resumeB, 3)
```

## Combining Functions

```{r}
## subset data with black, female-sounding names
## Then, let'ss remove the firstname
resumeBf_without_firstname <- resume %>% 
  filter(race == "black" & sex == "female") %>% 
  select(!firstname)
resumeBf_without_firstname
```


# Summarize Data
## `summarise()`
\tiny
```{r}
## callback rate for black female names
Bf_callback <- resume %>% 
  filter(race == "black" & sex =="female") %>%
  summarize(callback_rate = mean(call, na.rm = TRUE))

Bf_callback

## callback rate for white female names
Wf_callback <- resume %>% 
  filter(race == "white" & sex == "female") %>%
  summarize(callback_rate = mean(call, na.rm = TRUE))

Wf_callback

## difference between white and black women
Wf_callback - Bf_callback
```

# Add New Variable
## `mutate()`
\tiny

### calculate target values
The way we did previously with `filter()` and `summarise()`. 

### create factor variable with `mutate`
```{r}
## create a factor variable that takes one of the four values
resume <- resume %>%
  mutate(type = case_when(race == "black" & sex == "female" ~ "BlackFemale",
                          race == "black" & sex == "male" ~ "BlackMale",
                          race == "white" & sex == "female" ~ "WhiteFemale",
                          race == "white" & sex == "male" ~ "WhiteMale",
                          TRUE ~ "Other"))

head(resume)
```

# Summary

## Let's practice!
```{r fig.show="hold", out.width="80%", fig.align='center', echo=FALSE}
ggdraw() + 
  draw_image("figure/dplyr.png") 
```
*Source: [RStudio](https://www.rstudio.com/resources/webinars/tidyverse-visualization-manipulation-basics/)*
